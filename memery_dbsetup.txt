Drop Table IF EXISTS memes;
Drop Table IF EXISTS templates;
Drop Table IF EXISTS users;

CREATE TABLE users(
id INT UNSIGNED NOT NULL AUTO_INCREMENT,
username varchar(64) NOT NULL default '',
password char(64) binary NOT NULL default '',
first_name varchar(64) NOT NULL default '',
last_name varchar(64) NOT NULL default '',
nickname varchar(64),
created_at DATETIME NOT NULL,
last_login DATETIME,
cookie char(64) binary NOT NULL default '',
session char(64) binary NOT NULL default '',
ip varchar(16) binary NOT NULL default '',
PRIMARY KEY (id),
UNIQUE KEY username (username),
UNIQUE KEY nickname (nickname)
);

CREATE TABLE templates(
id INT UNSIGNED NOT NULL AUTO_INCREMENT,
name varchar(64) NOT NULL default 'unnamed',
src varchar(64) NOT NULL,
created_by INT NOT NULL,
created_at DATETIME NOT NULL,
crop_x0 INT default 0,
crop_y0 INT default 0,
crop_x1 INT default 100,
crop_y1 INT default 100,
PRIMARY KEY(id),
UNIQUE KEY(src),
FOREIGN KEY(created_by) references users(id)
);

CREATE TABLE memes(
id INT UNSIGNED NOT NULL AUTO_INCREMENT,
title varchar(64) NOT NULL default 'unnamed',
template_id INT NOT NULL,
created_by INT NOT NULL,
created_at DATETIME NOT NULL,
text_top varchar(128),
text_bot varchar(128),
PRIMARY KEY(id),
FOREIGN KEY(template_id) references templates(id),
FOREIGN KEY(created_by) references users(id)
);
